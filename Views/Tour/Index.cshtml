@model IEnumerable<TravelWebsite.Models.Tour>
@{
    ViewData["Title"] = "Tour Du Lịch";
}

@section Styles {
    <link rel="stylesheet" href="~/css/tour.css" asp-append-version="true" />
}

<!-- Tour Banner -->
<div class="tour-banner text-white py-5">
    <div class="container py-4">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <h1 class="tour-title display-4 fw-bold mb-3">Khám Phá Tour Du Lịch</h1>
                <p class="tour-subtitle lead mb-4">Trải nghiệm những chuyến đi tuyệt vời với các gói tour hấp dẫn, được thiết kế đặc biệt để tạo nên những kỷ niệm khó quên.</p>
                @if (User.IsInRole("Admin"))
                {
                    <a asp-action="Create" class="btn btn-light tour-button px-4 py-2">
                        <i class="bi bi-plus-circle me-2"></i> Thêm Tour Mới
                    </a>
                }
            </div>
            <div class="col-lg-5 d-none d-lg-block">
                <div class="position-relative" data-aos="fade-left">
                    <img src="@Url.Content("~/images/general/banner-tour.jpg")" alt="Tour Du Lịch" class="img-fluid rounded-3 shadow-lg" style="border: 5px solid rgba(255,255,255,0.2);">
                    <div class="position-absolute top-0 end-0 translate-middle-y p-3 bg-white rounded-circle shadow-lg" style="margin-right: -20px;">
                        <i class="bi bi-airplane-fill text-danger" style="font-size: 2rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container py-5">
    <!-- Statistics -->
    <div class="tour-stats mb-5" data-aos="fade-up">
        <div class="tour-stat-card">
            <i class="bi bi-map"></i>
            <h3 class="stat-value counter-value" data-target="@Model.Count()">0</h3>
            <p class="stat-label">Tours Du Lịch</p>
        </div>
        <div class="tour-stat-card">
            <i class="bi bi-geo-alt"></i>
            <h3 class="stat-value counter-value" data-target="@Model.Select(t => t.Destination).Distinct().Count()">0</h3>
            <p class="stat-label">Điểm Đến</p>
        </div>
        <div class="tour-stat-card">
            <i class="bi bi-star"></i>
            <h3 class="stat-value counter-value" data-target="@Model.Count(t => t.IsPopular)">0</h3>
            <p class="stat-label">Tours Phổ Biến</p>
        </div>
        <div class="tour-stat-card">
            <i class="bi bi-people"></i>
            <h3 class="stat-value counter-value" data-target="1500">0</h3>
            <p class="stat-label">Khách Hàng Hài Lòng</p>
        </div>
    </div>

    <!-- Advanced Filter -->
    <div class="tour-filter-panel p-4" data-aos="fade-up">
        <h5 class="fw-bold mb-4"><i class="bi bi-funnel me-2"></i>Tìm kiếm tour du lịch</h5>
        <form method="get" class="tour-search-form">
            <div class="row g-3">
                <div class="col-lg-4 col-md-6 filter-col">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-search text-muted"></i></span>
                        <input type="text" class="form-control" id="searchName" name="searchName" placeholder="Tên tour du lịch...">
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 filter-col">
                    <select class="form-select" id="filterPrice" name="filterPrice">
                        <option value="all">Tất cả giá</option>
                        <option value="under1m">Dưới 1 triệu</option>
                        <option value="1m-3m">1 - 3 triệu</option>
                        <option value="3m-5m">3 - 5 triệu</option>
                        <option value="5m-10m">5 - 10 triệu</option>
                        <option value="over10m">Trên 10 triệu</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-6 filter-col">
                    <select class="form-select" id="filterDuration" name="filterDuration">
                        <option value="all">Thời gian tour</option>
                        <option value="1-3days">1 - 3 ngày</option>
                        <option value="4-7days">4 - 7 ngày</option>
                        <option value="8-14days">8 - 14 ngày</option>
                        <option value="over14days">Trên 14 ngày</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-6 filter-col">
                    <select class="form-select" id="tourSort" name="tourSort">
                        <option value="default">Sắp xếp</option>
                        <option value="price-asc">Giá: Thấp đến cao</option>
                        <option value="price-desc">Giá: Cao đến thấp</option>
                        <option value="name-asc">Tên: A-Z</option>
                        <option value="name-desc">Tên: Z-A</option>
                        <option value="popular">Tours phổ biến</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-12 d-flex">
                    <button type="submit" class="btn tour-search-btn text-white w-100 me-2">
                        <i class="bi bi-search me-2"></i>Tìm kiếm
                    </button>
                    <button type="button" class="btn btn-outline-secondary reset-filters">
                        <i class="bi bi-arrow-repeat"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Tours List -->
    <div class="tour-grid row g-4 mt-4">
        @if (Model.Any())
        {
            @foreach (var tour in Model)
            {
                <div class="col-lg-4 col-md-6 mb-4 tour-card-wrapper" 
                     data-name="@tour.Name" 
                     data-price="@tour.Price" 
                     data-duration="@tour.Duration" 
                     data-popular="@tour.IsPopular.ToString().ToLower()">
                    <div class="card h-100 border-0 shadow-sm tour-card">
                        <div class="position-relative">
                            @{
                                var tourIndex = Array.IndexOf(new[] { "Khám phá Đà Nẵng 3 ngày 2 đêm", "Du ngoạn Vịnh Hạ Long", "Khám phá Phố cổ Hội An", "Khám phá Cố đô Huế", "Đà Lạt mộng mơ", "Khám phá biển Nha Trang" }, tour.Name) + 1;
                                var imageIndex = tourIndex > 0 ? tourIndex : (tour.Id % 6) + 1;
                            }
                            <img src="@Url.Content($"~/images/tours/tour-{imageIndex}.jpg")" 
                                 onerror="this.onerror=null;this.src=@(string.IsNullOrEmpty(tour.ImageUrl) ? "'https://placehold.co/600x400?text=No+Image'" : $"'{tour.ImageUrl}'")"
                                 class="card-img-top" alt="@tour.Name">
                            <div class="tour-card-overlay"></div>
                            <div class="tour-price">
                                <strong>@tour.Price.ToString("N0") VNĐ</strong>
                            </div>
                            @if (tour.IsPopular)
                            {
                                <div class="tour-popular">
                                    <i class="bi bi-star-fill"></i> Phổ biến
                                </div>
                                <div class="tour-featured">
                                    <i class="bi bi-bookmark-star-fill"></i>
                                </div>
                            }
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">@tour.Name</h5>
                            <div class="tour-info-item">
                                <div class="tour-info-icon">
                                    <i class="bi bi-geo-alt"></i>
                                </div>
                                <span>@tour.Destination.Name, @tour.Destination.Country</span>
                            </div>
                            <div class="tour-info-item">
                                <div class="tour-info-icon">
                                    <i class="bi bi-clock"></i>
                                </div>
                                <span>@(tour.Duration.HasValue ? $"{tour.Duration} ngày" : "Liên hệ để biết thêm chi tiết")</span>
                            </div>
                            <div class="tour-info-item">
                                <div class="tour-info-icon">
                                    <i class="bi bi-calendar-check"></i>
                                </div>
                                <span>Khởi hành hàng ngày</span>
                            </div>
                            <p class="card-text mt-3">@(string.IsNullOrEmpty(tour.Description) 
                                ? "Khám phá tour du lịch tuyệt vời này cùng chúng tôi." 
                                : (tour.Description.Length > 100 ? tour.Description.Substring(0, 100) + "..." : tour.Description))</p>
                        </div>
                        <div class="card-footer bg-white border-top-0 pt-0">
                            <a asp-action="Details" asp-route-id="@tour.Id" class="btn btn-outline-primary w-100">
                                Xem chi tiết <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                            @if (User.IsInRole("Admin"))
                            {
                                <div class="d-flex justify-content-between mt-3 tour-admin-buttons">
                                    <a asp-action="Edit" asp-route-id="@tour.Id" class="btn btn-sm btn-outline-secondary w-50 me-1">
                                        <i class="bi bi-pencil me-1"></i> Sửa
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@tour.Id" class="btn btn-sm btn-outline-danger w-50 ms-1">
                                        <i class="bi bi-trash me-1"></i> Xóa
                                    </a>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>
    
    <!-- Empty state (hidden by default) -->
    <div class="tour-empty-state" style="@(Model.Any() ? "display: none;" : "")">
        <i class="bi bi-ticket-perforated"></i>
        <h4>Không tìm thấy tour du lịch nào</h4>
        <p>Hiện tại không có tour du lịch nào phù hợp với tiêu chí tìm kiếm của bạn. Vui lòng thử lại với các bộ lọc khác.</p>
        @if (User.IsInRole("Admin"))
        {
            <a asp-action="Create" class="btn btn-primary mt-3">
                <i class="bi bi-plus-circle me-2"></i> Thêm Tour Mới
            </a>
        }
        else
        {
            <button type="button" class="btn btn-primary mt-3 reset-filters">
                <i class="bi bi-arrow-repeat me-2"></i> Đặt lại bộ lọc
            </button>
        }
    </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/tour.js" asp-append-version="true"></script>
}